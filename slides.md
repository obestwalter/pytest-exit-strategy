# Pytest Deprecation Policy

![exit strategy](img/exit-strategy.jpg)

# Why?

* Functionality that has better alternatives still kept around without clear exit strategy
* 3.0 is a good point in time to introduce a deprecation policy
* Been mainly at the receiving end of deprecation and been bitten (requests, flask)

# presenter notes

Usual reason for deprecation is not removing functionality, but to replace OldBusted eay of doing things with NewHotness way of things - so you should actially not despair if you see a deprecation warning but rather cherish the new and much easier way to accomplish your tasks.

Emerging design leads to warts that need to be ironed out at some point to keep the code maintainable and accessible for newcomers.

Want to know how to do it right/gentle might be boring, annoying for old hands but for me something where i feel i could be useful.

I would be interested to 'sell' the new policy to users (especially that we're aware of the pain and that we will not flood them with 'clusters of deprecation' (good name for a progressive death metal band)

users relax: pytest 3.0 != python 3.0

---

# Get rid of old busted stuff ...

![old vs new](img/old-busted-new-hotness.jpg)

---

# Without pissing people off (too much)

![old vs new](img/we-dont-want-angry-mob.jpg)

---

# How?

* Fix related pending issues about warnings
* Switch (deprecation) warnings (generated by pytest) on by default in 3.0
* Versioned deprecation and good reporting (python-deprecate, pytest-warnings)
* Deprecation warnings clearly document the upgrade path right in the warning
* Keep deprecations for at least two minor releases (silent -> loud -> BOOM!)
* Remove deprecated features only in major releases (=> first chance in 4.0)

---

# When?

* Tell people about it as part of the 3.0 release
* First step: Report warnings as default as part of 3.0 release
* First removals of deprecated functionality in 4.0

---

# Looked at ...

* python itself
* plone/zope
* django
* SemVer
* checked pytest issues to do with warnings and deprecation

---

# What is deprecated already? I

* Config.option
* Config.getplugin
* Config.getvalue
* Config.getvalueorskip
* PluginManager: pm.addhooks

---

# What is deprecated already? II

* pytest_cmdline_preparse
* yield_fixture (oldest deprecation? Since 1.10) 
* funcargnames
* cached_setup
* pytest_itemstart

---

# What is deprecated already? III

* compatproperty.fget
* tmpdir.ensuretemp
* genscript.py
* addcall
* Node.X access

---

# What is deprecated already? IV

* for tests: deprecated_call
* outerr usage in repr_failure
* command line option --report (use -r)
* command line option --no-assert (--assert=plain)
* command line option --nomagic (--assert=plain)

---

# Last but not least ...

**`__multicall__`**

* deprecated for quite a while
* Could lead to a 30% performance increase

# presenter notes

todo:

- determine timings
- See how it's done atm (consistent? Concrete timings?)
- explore tooling (python-deprecate, pytest-warnings, ...)

---

# Related issues I

*  re-enable all warnings by default [#1191](https://github.com/pytest-dev/pytest/issues/1191)
*  pytest should integrate with warnings module [#253](https://github.com/pytest-dev/pytest/issues/253) 
*  Recwarn empty [#28](https://github.com/pytest-dev/pytest/issues/28) 
*  xdist does not report warnings [#602](https://github.com/pytest-dev/pytest/issues/602)
*  Inconsistent behaviour of recwarn [#840](https://github.com/pytest-dev/pytest/issues/840)
*  Option to treat warnings as errors [#1173](https://github.com/pytest-dev/pytest/issues/1173)

---

# Related issues II

*  py.test ignores warnings.simplefilter [#1043](https://github.com/pytest-dev/pytest/issues/1043)
*  Test run summary bar is yellow but not clear why, after updating to v2.8.2 [#1179](https://github.com/pytest-dev/pytest/issues/1179)
*  Warnings do not become errors with `--strict` [#1381](https://github.com/pytest-dev/pytest/issues/1381)
*  Indicate non-pytest warnings in the UI [#1262](https://github.com/pytest-dev/pytest/issues/1262)
*  PendingDeprecationWarning triggered when run with -Werror [#1403](https://github.com/pytest-dev/pytest/issues/1403)
